<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel - SMPN SATU ATAP TUBAKI</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        :root { --blue-dark: #1e3a5f; --blue-light: #00509d; --bg-light: #f4f7f6; --white: #ffffff; --danger: #e74c3c; --success: #27ae60; --warning: #f39c12; }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { display: flex; background: var(--bg-light); }

        /* Sidebar */
        .sidebar { width: 280px; background: var(--blue-dark); color: white; min-height: 100vh; position: fixed; padding: 20px 0; z-index: 100; }
        .sidebar h2 { text-align: center; font-size: 1.2rem; margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 15px; letter-spacing: 1px; }
        .sidebar nav a { display: block; padding: 15px 25px; color: #bdc3c7; text-decoration: none; transition: 0.3s; font-size: 0.95rem; cursor: pointer; }
        .sidebar nav a i { margin-right: 15px; width: 20px; text-align: center; }
        .sidebar nav a:hover, .sidebar nav a.active { background: rgba(255,255,255,0.1); color: white; border-left: 4px solid #b8860b; }
        .logout-btn { margin-top: 20px; color: #ff7675 !important; border-top: 1px solid rgba(255,255,255,0.1); }

        /* Main Content */
        .main-content { margin-left: 280px; width: calc(100% - 280px); padding: 30px; }
        header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
        
        /* Panel System */
        .panel { display: none; }
        .panel.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Stats & Cards */
        .stats-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; display: flex; align-items: center; gap: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .stat-card i { font-size: 2.5rem; color: var(--blue-dark); }
        .stat-card h3 { font-size: 1.8rem; color: var(--blue-dark); }
        .stat-card p { font-size: 0.85rem; color: #7f8c8d; }

        .card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); margin-bottom: 20px; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        table th { background: #f8f9fa; color: var(--blue-dark); padding: 12px; text-align: left; font-size: 0.9rem; }
        table td { padding: 12px; border-bottom: 1px solid #eee; font-size: 0.85rem; vertical-align: middle; }
        
        .btn { padding: 8px 15px; border: none; border-radius: 6px; cursor: pointer; text-decoration: none; font-size: 0.8rem; font-weight: 600; display: inline-flex; align-items: center; gap: 8px; transition: 0.2s; }
        .btn-wa { background: #25d366; color: white; }
        .btn-del { background: var(--danger); color: white; }
        .btn-view { background: var(--blue-light); color: white; }
        .btn-excel { background: var(--success); color: white; }
        .btn:hover { opacity: 0.8; transform: scale(1.02); }

        .admin-form { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; background: #f9f9f9; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .admin-form input, .admin-form textarea, .admin-form select { padding: 10px; border: 1px solid #ddd; border-radius: 5px; width: 100%; font-size: 0.9rem; }
        .admin-form .full-width { grid-column: span 2; }
        .table-img { width: 80px; height: 50px; object-fit: cover; border-radius: 4px; border: 1px solid #ddd; }
    </style>
</head>
<body>

    <aside class="sidebar">
        <h2>PANEL KONTROL</h2>
        <nav id="admin-nav">
            <a href="#" data-target="dash" class="active"><i class="fas fa-chart-line"></i> Dashboard</a>
            <a href="#" data-target="ppdb"><i class="fas fa-user-graduate"></i> Pengelolaan PPDB</a>
            <a href="#" data-target="berita"><i class="fas fa-newspaper"></i> Berita & Artikel</a>
            <a href="#" data-target="pengumuman"><i class="fas fa-bullhorn"></i> Pengumuman</a>
            <a href="#" data-target="guru"><i class="fas fa-user-tie"></i> Data Guru</a>
            <a href="#" data-target="slider"><i class="fas fa-images"></i> Slider Hero</a>
            <a href="#" data-target="galeri"><i class="fas fa-photo-video"></i> Galeri</a>
            <a href="#" data-target="stats-panel"><i class="fas fa-calculator"></i> Kelola Statistik</a>
            <a href="/logout" class="logout-btn"><i class="fas fa-sign-out-alt"></i> Logout</a>
        </nav>
    </aside>

    <main class="main-content">
        <header>
            <div>
                <h2 id="current-title">Dashboard Overview</h2>
                <p style="font-size: 0.8rem; color: #666;">Administrator SMPN SATU ATAP TUBAKI</p>
            </div>
            <img src="/gambar/logo1.png" alt="Logo" height="40">
        </header>

        <div id="dash" class="panel active">
            <div class="stats-container">
                <div class="stat-card">
                    <i class="fas fa-users"></i>
                    <div><h3><%= daftarPendaftar.length %></h3><p>Pendaftar</p></div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-newspaper"></i>
                    <div><h3><%= daftarBerita.length %></h3><p>Berita</p></div>
                </div>
                <div class="stat-card">
                    <i class="fas fa-bullhorn"></i>
                    <div><h3><%= daftarPengumuman.length %></h3><p>Pengumuman</p></div>
                </div>
            </div>
            <div class="card">
                <h3>Selamat Datang</h3>
                <p>Kelola seluruh konten website Anda secara terpusat di sini.</p>
            </div>
        </div>

        <<div id="stats-panel" class="panel">
    <div class="card">
        <div class="card-header">
            <h3><i class="fas fa-edit"></i> Update Angka Statistik</h3>
        </div>
        <form action="/admin/update-statistik" method="POST" class="admin-form">
            <div>
                <label>Jumlah Ruang Belajar</label>
                <input type="number" name="ruang" required value="<%= typeof stats !== 'undefined' ? stats.ruang_belajar : '' %>">
            </div>
            <div>
                <label>Jumlah Tenaga Pendidik</label>
                <input type="number" name="guru" required value="<%= typeof stats !== 'undefined' ? stats.tenaga_pendidik : '' %>">
            </div>
            <div>
                <label>Jumlah Tenaga Kependidikan</label>
                <input type="number" name="staf" required value="<%= typeof stats !== 'undefined' ? stats.tenaga_kependidikan : '' %>">
            </div>
            <div>
                <label>Jumlah Murid</label>
                <input type="number" name="murid" required value="<%= typeof stats !== 'undefined' ? stats.murid : '' %>">
            </div>
            <button type="submit" class="btn btn-view full-width" style="margin-top: 20px;">
                <i class="fas fa-save"></i> Simpan Perubahan Statistik
            </button>
        </form>
    </div>
</div>

        <div id="ppdb" class="panel">
            <div class="card">
                <div class="card-header">
                    <h3>Daftar Calon Siswa</h3>
                    <a href="/admin/ekspor-ppdb" class="btn btn-excel">
                        <i class="fas fa-file-excel"></i> Ekspor ke Excel
                    </a>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Nama Lengkap</th>
                            <th>Asal Sekolah</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
                        <% daftarPendaftar.forEach(siswa => { %>
                            <tr>
                                <td><strong><%= siswa.nama_lengkap %></strong></td>
                                <td><%= siswa.sekolah_asal %></td>
                                <td>
                                    <a href="https://wa.me/<%= siswa.whatsapp %>" target="_blank" class="btn btn-wa"><i class="fab fa-whatsapp"></i> Chat</a>
                                    <a href="/admin/hapus-ppdb/<%= siswa.id %>" class="btn btn-del" onclick="return confirm('Hapus data pendaftar ini?')"><i class="fas fa-trash"></i></a>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="berita" class="panel">
            <div class="card">
                <h3>Tambah Berita & Artikel</h3>
                <form action="/admin/tambah-berita" method="POST" enctype="multipart/form-data" class="admin-form">
                    <input type="text" name="judul" placeholder="Judul Berita" class="full-width" required>
                    <textarea name="isi" placeholder="Isi Berita..." class="full-width" rows="5" required></textarea>
                    <label>Pilih Gambar Berita:</label>
                    <input type="file" name="gambar_berita" accept="image/*" class="full-width" required>
                    <button type="submit" class="btn btn-view full-width">Posting Berita</button>
                </form>
                <hr style="margin: 20px 0;">
                <h3>Daftar Berita</h3>
                <table>
                    <thead><tr><th>Gambar</th><th>Judul</th><th>Aksi</th></tr></thead>
                    <tbody>
                        <% daftarBerita.forEach(b => { %>
                            <tr>
                                <td><img src="/gambar/<%= b.gambar %>" class="table-img"></td>
                                <td><%= b.judul %></td>
                                <td>
                                    <a href="/admin/hapus-berita/<%= b.id %>" class="btn btn-del" onclick="return confirm('Hapus berita ini?')">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="pengumuman" class="panel">
            <div class="card">
                <h3>Upload Pengumuman (PDF)</h3>
                <form action="/admin/tambah-pengumuman" method="POST" enctype="multipart/form-data">
    <input type="text" name="judul" placeholder="Judul Pengumuman" required>
    
    <input type="file" name="file_pdf" accept=".pdf" required> 
    
    <button type="submit">Simpan Pengumuman</button>
</form>
                <hr style="margin: 20px 0;">
                <table>
                    <thead><tr><th>Nama Pengumuman</th><th>Aksi</th></tr></thead>
                    <tbody>
                        <% daftarPengumuman.forEach(p => { %>
                            <tr>
                                <td><i class="fas fa-file-pdf" style="color: #e74c3c;"></i> <%= p.judul %></td>
                                <td>
                                    <a href="/admin/hapus-pengumuman/<%= p.id %>" class="btn btn-del" onclick="return confirm('Hapus pengumuman ini?')">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="guru" class="panel">
            <div class="card">
                <h3>Kelola Data Guru</h3>
                <form action="/admin/tambah-guru" method="POST" enctype="multipart/form-data" class="admin-form">
                    <input type="text" name="nama" placeholder="Nama Lengkap" required>
                    <input type="text" name="jabatan" placeholder="Jabatan" required>
                    <label class="full-width">Foto Guru:</label>
                    <input type="file" name="foto" accept="image/*" class="full-width">
                    <button type="submit" class="btn btn-view full-width">Simpan Data Guru</button>
                </form>
                <hr style="margin: 20px 0;">
                <table>
                    <thead><tr><th>Foto</th><th>Nama</th><th>Jabatan</th><th>Aksi</th></tr></thead>
                    <tbody>
                        <% daftarGuru.forEach(g => { %>
                            <tr>
                                <td><img src="/gambar/<%= g.foto %>" class="table-img" style="width: 40px; height: 40px; border-radius: 50%;"></td>
                                <td><%= g.nama %></td>
                                <td><%= g.jabatan %></td>
                                <td>
                                    <a href="/admin/hapus-guru/<%= g.id %>" class="btn btn-del" onclick="return confirm('Hapus data guru ini?')">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="slider" class="panel">
            <div class="card">
                <h3>Upload Slider Beranda</h3>
                <form action="/admin/tambah-slider" method="POST" enctype="multipart/form-data" class="admin-form">
                    <input type="text" name="judul" placeholder="Judul Gambar" class="full-width" required>
                    <input type="text" name="sub_judul" placeholder="Sub Judul" class="full-width">
                    <label>Pilih Gambar:</label>
                    <input type="file" name="gambar_slider" accept="image/*" class="full-width" required>
                    <button type="submit" class="btn btn-view full-width">Upload Slider</button>
                </form>
                <hr style="margin: 20px 0;">
                <table>
                    <thead><tr><th>Gambar</th><th>Judul</th><th>Aksi</th></tr></thead>
                    <tbody>
                        <% daftarSlider.forEach(s => { %>
                            <tr>
                                <td><img src="/gambar/<%= s.gambar %>" class="table-img"></td>
                                <td><%= s.judul %></td>
                                <td>
                                    <a href="/admin/hapus-slider/<%= s.id %>" class="btn btn-del" onclick="return confirm('Hapus slider ini?')"><i class="fas fa-trash"></i></a>
                                </td>
                            </tr>
                        <% }) %>
                    </tbody>
                </table>
            </div>
        </div>

        <div id="galeri" class="panel">
            <div class="card">
                <h3>Kelola Galeri Foto/Video</h3>
                <form action="/admin/tambah-galeri" method="POST" enctype="multipart/form-data" class="admin-form">
                    <select name="tipe" id="tipeGaleri" onchange="switchGaleriInput()" class="full-width">
                        <option value="foto">Foto Kegiatan</option>
                        <option value="video">Video (YouTube Link)</option>
                    </select>
                    <input type="text" name="judul" placeholder="Keterangan" class="full-width" required>
                    <div id="boxFoto" class="full-width">
                        <input type="file" name="file_galeri" accept="image/*">
                    </div>
                    <div id="boxVideo" class="full-width" style="display:none;">
                        <input type="text" name="link_video" placeholder="Paste Link YouTube">
                    </div>
                    <button type="submit" class="btn btn-view full-width">Simpan Galeri</button>
                </form>
            </div>
        </div>

    </main>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const navLinks = document.querySelectorAll('#admin-nav a[data-target]');
        const panels = document.querySelectorAll('.panel');
        const titleDisplay = document.getElementById('current-title');

        navLinks.forEach(link => {
            link.addEventListener('click', function(e) {
                const targetId = this.getAttribute('data-target');
                
                if (targetId) {
                    e.preventDefault(); 
                    e.stopPropagation();

                    // 1. Update Sidebar Aktif
                    navLinks.forEach(l => l.classList.remove('active'));
                    this.classList.add('active');

                    // 2. Sembunyikan semua panel
                    panels.forEach(p => {
                        p.classList.remove('active');
                        p.style.display = 'none';
                    });

                    // 3. Tampilkan panel yang dipilih
                    const activePanel = document.getElementById(targetId);
                    if (activePanel) {
                        activePanel.classList.add('active');
                        activePanel.style.display = 'block';
                        titleDisplay.innerText = this.innerText.trim();
                    }
                }
            });
        });
    });

    function switchGaleriInput() {
        const tipe = document.getElementById('tipeGaleri').value;
        document.getElementById('boxFoto').style.display = (tipe === 'foto') ? 'block' : 'none';
        document.getElementById('boxVideo').style.display = (tipe === 'video') ? 'block' : 'none';
    }
    </script>
</body>
</html>